I"Ó(function() {
  var activateChosen;

  activateChosen = function() {
    return $('select.chosen-select').attr("data-placeholder", " ").chosen({
      allow_single_deselect: false,
      no_results_text: 'No results found',
      width: '',
      inherit_select_classes: true,
      disable_search_threshold: 5
    });
  };

  $('body').on('click', '#add_profile_field', function() {
    return $.ajax({
      url: window.new_field_url,
      dataType: "json",
      async: false,
      success: function(data, status, xhr) {
        $('#add_profile_field_popup_container').html(data.html);
        activateChosen();
        showPopup('#profile_field_popup');
        return window.new_field = true;
      }
    });
  });

  $('body').on('click', '.popup_closer', function() {
    return $(this).closest('.popup').hide();
  });

  $('body').on('change', '#field_type_box .field_type', function() {
    var selected;
    selected = $(this).val();
    $('#field_type_box .up_field_option').hide();
    if (selected === 'CalculatedField') {
      return $('#calculated_field_box').show();
    } else if (selected === 'ConditionalField') {
      return $('#conditional_field_box').show();
    }
  });

  $('body').on('click', '#add_calculated_cond', function() {
    var idx, template;
    template = Handlebars.compile($('#calculated_field_cond_template').html());
    idx = $('#cal_field_def_area .cal_def_entry').length + 1;
    $('#cal_field_def_area').append(template({
      idx: idx
    }));
    $('.remove_cal_def_entry').show();
    return activateChosen();
  });

  $('body').on('click', '.remove_cal_def_entry', function(event) {
    var parent_box, total_condtions;
    parent_box = $(this).closest('.cal_def_entry');
    $(parent_box).remove();
    total_condtions = $('#cal_field_def_area .cal_def_entry').length;
    if (total_condtions < 2) {
      return $('.remove_cal_def_entry').hide();
    }
  });

  $('body').on('change', '.cal_def_entry .sub_rule_option', function() {
    var parent_box, selected_option;
    parent_box = $(this).closest('.cal_def_entry');
    $(parent_box).find('.sub_rule').hide();
    selected_option = $(this).val();
    if (selected_option === '1') {
      return $(parent_box).find('div.sub_rule_' + selected_option).show();
    } else {
      return $(parent_box).find('.sub_rule_' + selected_option).show();
    }
  });

  $(window).resize(function() {
    return showPopup('#profile_field_popup');
  });

  $('body').on('click', '#save_profile_field', function() {
    $("#profile_field_popup #cal_field_def_area .position ").each(function(index) {
      return $(this).val(index);
    });
    return $.ajax({
      url: window.update_profile_fields_url,
      dataType: "json",
      data: $('#profile_fields_form').serialize(),
      type: "POST",
      success: function(data, status, xhr) {
        return window.location.reload();
      }
    });
  });

  $('body').on('click', '.edit_link', function() {
    var id;
    id = $(this).attr('id');
    return $.ajax({
      url: window.base_field_url + id + '/edit',
      dataType: "json",
      async: false,
      success: function(data, status, xhr) {
        $('#add_profile_field_popup_container').html(data.html);
        activateChosen();
        $('.chosen-select.hidden').hide();
        showPopup('#profile_field_popup');
        return window.new_field = false;
      }
    });
  });

  $('body').on('change', '#field_name', function() {
    if (window.new_field) {
      if ($('#first_expression_field option[value="self"]').length <= 0) {
        return $('#first_expression_field').append('<option value=self>' + $(this).val() + '</option>');
      } else {
        return $('#first_expression_field option[value="self"]').text($(this).val());
      }
    }
  });

}).call(this);
:ET