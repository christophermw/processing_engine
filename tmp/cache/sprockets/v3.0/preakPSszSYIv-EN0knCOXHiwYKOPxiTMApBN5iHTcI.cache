I"q(function() {
  var activateChosen, getTag;

  activateChosen = function() {
    return $('.chosen-select').attr("data-placeholder", " ").chosen({
      allow_single_deselect: true,
      no_results_text: 'No results matched',
      width: '300px'
    });
  };

  $('.popup_opener').click(function() {
    var id, popup_id;
    id = $(this).attr('id');
    popup_id = '#' + id + "_popup";
    return showPopup(popup_id);
  });

  $('.popup_closer').click(function() {
    return $(this).closest('.popup').hide();
  });

  $('#add_tag_fields').click(function() {
    var idx, template;
    template = Handlebars.compile($("#tag_field_entry_template").html());
    idx = $("#fields_entry_area .field_entry").length + 1;
    $("#fields_entry_area #fields_box").append(template({
      idx: idx
    }));
    activateChosen();
    return $('#field_entries').html(idx);
  });

  $('#save_tag').click(function() {
    return $.ajax({
      url: window.update_tags_url,
      dataType: "json",
      data: $('#tag_form').serialize(),
      type: "POST",
      success: function(data, status, xhr) {
        return window.location.reload();
      }
    });
  });

  getTag = function(id) {
    return $.ajax({
      url: '/tags/' + id,
      dataType: "json",
      success: function(data, status, xhr) {
        var field, i, idx, len, ref, template;
        $("#tag_id").val(data.id);
        $("#tag_name").val(data.name);
        $("#tag_description").val(data.description);
        $('#fields_entry_area #fields_box').empty();
        template = Handlebars.compile($("#tag_field_entry_template").html());
        ref = data.tag_fields;
        for (i = 0, len = ref.length; i < len; i++) {
          field = ref[i];
          idx = $("#fields_entry_area .field_entry").length + 1;
          $("#fields_entry_area #fields_box").append(template({
            idx: idx
          }));
          $(".field_id:last").val(field.id);
          $(".field_name:last").val(field.name);
          $(".field:last").val(field.name);
          $(".data_type:last").val(field.datatype);
          $(".data_type_value:last").val(field.datatype);
        }
        activateChosen();
        return showPopup("#add_tag_popup");
      }
    });
  };

  $('.edit_tag').click(function() {
    return getTag($(this).data('id'));
  });

  $('body').on('click', '.remove_field_entry', function() {
    var parent_box, tags_fields_area;
    parent_box = $(this).closest('.field_entry');
    parent_box.hide();
    $(parent_box).find('.destroy_field').val(true);
    tags_fields_area = parent_box.find('.tags_fields');
    return tags_fields_area.empty();
  });

  $('body').on('change', '.field', function() {
    var idx, parent_box, tags_fields_area, template;
    parent_box = $(this).closest('.field_entry');
    tags_fields_area = parent_box.find('.tags_fields');
    template = Handlebars.compile($("#tags_field_template").html());
    idx = $(".tags_field").length + 1;
    $(parent_box).find('.destroy_field').val(true);
    if (window.fields_by_name[$(this).val()]) {
      return tags_fields_area.append(template({
        idx: idx,
        field_id: window.fields_by_name[$(this).val()].id
      }));
    }
  });

  $('body').on('change', '.data_type', function() {
    var parent_box;
    parent_box = $(this).closest('.field_entry');
    return parent_box.find('.data_type_value').val($(this).val());
  });

  $('body').on('keyup', '.chosen-search input', function() {
    var parent_box;
    if (event.keyCode === 13) {
      parent_box = $(this).closest('.field_entry');
      parent_box.find('.field').append("<option value=" + $(this).val() + ">" + $(this).val() + "</option>");
      parent_box.find('.field_name').val($(this).val());
      parent_box.find('.field').val($(this).val());
      parent_box.find('.data_type_value').val(parent_box.find('.data_type').val());
      return parent_box.find('.field').trigger('chosen:updated');
    }
  });

}).call(this);
:ET